<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- The title of our web page that appears in the browser tab -->
    <title>Serene Scanner | Scam Detection</title>

    <!-- 1. IMPORT TAILWIND CSS -->
    <!-- We use a CDN link so we don't have to install anything locally. This provides all the utility classes we need to style our application. -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 2. IMPORT GOOGLE FONTS -->
    <!-- We are importing the 'Inter' font for a clean, professional typography style -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- 3. CUSTOM STYLES -->
    <!-- We define a few base styles here. Most styling is handled directly in the HTML elements using Tailwind classes. -->
    <style>
        body {
            /* Set our imported font as the default for the entire document */
            font-family: 'Inter', sans-serif;
        }

        /* 
         * Custom CSS Animation for smooth fade-ins.
         * When triggered, elements will slide up slightly and fade into view over 0.4 seconds.
         */
        .fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 
         * Custom CSS Loading Spinner. 
         * It spins infinitely giving the user visual feedback during the API fetch request.
         */
        .spinner {
            border: 2px solid transparent;
            /* The track of the spinner */
            border-top-color: white;
            /* The visible moving part is white */
            border-radius: 50%;
            /* Make it a circle */
            width: 1rem;
            height: 1rem;
            animation: spin 0.8s linear infinite;
            /* Spin the circle infinitely */
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<!-- 
  ===========================================
  PAGE LAYOUT (THE "SERENE UI" THEME)
  ===========================================
-->
<!-- The body background is a very soft slate color (bg-slate-50) to prevent eye strain. We center everything using flexbox. -->

<body class="bg-slate-50 min-h-screen flex items-center justify-center p-4 text-slate-800">

    <!-- THE MAIN CONTAINER -->
    <!-- This is the central card holding our app. It has a white background, rounded corners (rounded-2xl), a soft border, and a gentle shadow (shadow-sm). -->
    <main class="bg-white w-full max-w-2xl rounded-2xl border border-slate-100 shadow-sm p-8" id="app-container">

        <!-- HEADER TEXT -->
        <div class="text-center mb-8">
            <!-- Text colors use soft slates (text-slate-800 for heading, text-slate-500 for paragraph) -->
            <h1 class="text-2xl font-semibold text-slate-800 mb-2">Message Analysis</h1>
            <p class="text-sm text-slate-500">Paste an SMS or Email below to securely scan it for signs of phishing and
                fraud.</p>
        </div>

        <!-- INPUT SECTION -->
        <div class="mb-6 relative">
            <!-- 
                The Textarea Input:
                - bg-slate-50: A soft grey background
                - border-slate-200: A gentle, non-obtrusive border
                - focus:ring-blue-400: A calming blue glow when the user clicks inside to type
            -->
            <textarea id="message-input" rows="5"
                class="w-full bg-slate-50 border border-slate-200 rounded-xl p-4 text-slate-800 text-sm focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all placeholder-slate-400 resize-y"
                placeholder="Example: URGENT! Your account is suspended. Click here to verify..."></textarea>

            <!-- A subtle character counter text placeholder right under the input field -->
            <div class="flex justify-between items-center text-xs text-slate-400 mt-2 px-1">
                <span>Secure local scanning engine</span>
            </div>
        </div>

        <!-- TWO TABS / MODE SELECTOR (SMS vs Email) -->
        <!-- We use radio buttons styled as toggle buttons to let the user select between SMS and Email modes -->
        <div class="flex gap-4 mb-6" id="mode-selector">
            <label class="flex-1 cursor-pointer">
                <!-- Data attribute tells our Javascript what endpoint to use -->
                <input type="radio" name="scanType" value="sms" class="peer sr-only" checked>
                <!-- When checked (peer-checked), change background and text color to indicate selection -->
                <div
                    class="rounded-xl border border-slate-200 py-3 text-center text-sm font-medium text-slate-500 hover:bg-slate-50 peer-checked:bg-blue-50 peer-checked:text-blue-600 peer-checked:border-blue-200 transition-all">
                    ðŸ“± SMS Message
                </div>
            </label>
            <label class="flex-1 cursor-pointer">
                <input type="radio" name="scanType" value="email" class="peer sr-only">
                <div
                    class="rounded-xl border border-slate-200 py-3 text-center text-sm font-medium text-slate-500 hover:bg-slate-50 peer-checked:bg-blue-50 peer-checked:text-blue-600 peer-checked:border-blue-200 transition-all">
                    ðŸ“§ Email Content
                </div>
            </label>
        </div>

        <!-- PRIMARY BUTTON -->
        <!-- A calming blue button (bg-blue-500) that darkens slightly on hover. We center the text inside using flexbox. -->
        <button id="scan-button" onclick="startAnalysis()"
            class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 rounded-xl transition-colors shadow-sm flex items-center justify-center gap-2">
            <span id="button-text">Analyze Content</span>
            <div id="button-loader" class="spinner hidden"></div>
        </button>

        <!-- 
          ===========================================
          RESULTS SECTION (HIDDEN BY DEFAULT)
          ===========================================
        -->
        <!-- This entire container starts hidden (`hidden` class). Javascript removes the hidden class when data returns. -->
        <div id="result-container" class="mt-8 hidden opacity-0 transition-opacity duration-300">

            <!-- Result Alert Box that changes color dynamically -->
            <!-- We will inject our pastel background classes here using Javascript -->
            <div id="result-card" class="rounded-xl border p-5 pl-6 relative overflow-hidden">
                <!-- A soft glowing vertical strip along the left side to look elegant -->
                <div id="result-strip" class="absolute left-0 top-0 bottom-0 w-1 opacity-50"></div>

                <div class="flex justify-between items-start mb-4">
                    <!-- The Heading indicating the threat level -->
                    <div>
                        <p class="text-xs uppercase tracking-wider font-semibold opacity-70 mb-1" id="result-label">
                            Status</p>
                        <h2 class="text-xl font-bold" id="result-title">Analyzing...</h2>
                    </div>
                    <!-- The Score display out of 100 -->
                    <div class="text-right">
                        <span class="text-3xl font-bold tracking-tight" id="result-score">0</span>
                        <span class="text-xs opacity-70 block -mt-1">/100 Risk</span>
                    </div>
                </div>

                <!-- The detailed flags generated by our Heuristic Backend -->
                <div class="mt-4 pt-4 border-t border-black/5">
                    <p class="text-xs font-medium uppercase tracking-wider opacity-60 mb-2">Detection Flags</p>
                    <ul id="result-flags" class="text-sm space-y-1.5 opacity-90">
                        <!-- Javascript will dynamically add <li> elements here -->
                    </ul>
                </div>
            </div>

            <!-- "Scan Another" Reset Link -->
            <div class="mt-4 text-center">
                <button onclick="resetApp()" class="text-sm text-slate-500 hover:text-blue-500 transition-colors">
                    Clear and scan another message
                </button>
            </div>
        </div>

    </main>

    <!-- 
      ===========================================
      JAVASCRIPT LOGIC
      ===========================================
    -->
    <script>
        /**
         * The Main Function that triggers when the user clicks 'Analyze Content'.
         * We use async/await because making a network request to the backend takes time,
         * so we must 'wait' for the response before continuing our code execution.
         */
        async function startAnalysis() {
            // 1. Gather our HTML elements utilizing their IDs so we can read from or change them
            const textInput = document.getElementById('message-input');
            const scanButton = document.getElementById('scan-button');
            const buttonText = document.getElementById('button-text');
            const buttonLoader = document.getElementById('button-loader');
            const resultContainer = document.getElementById('result-container');

            // 2. Read what the user typed in the textarea and remove leading/trailing spaces via .trim()
            const content = textInput.value.trim();

            // 3. Validation: If the box is empty, don't run the check, just exit the function early.
            if (!content) {
                // Focus ring on the input to nudge them visually
                textInput.focus();
                return;
            }

            // 4. Figure out which 'Mode' the user selected by finding the checked radio button
            const modeRadios = document.getElementsByName('scanType');
            let selectedMode = 'sms'; // Default to SMS

            // Loop through the radio buttons to see which one was checked by the user
            for (let radio of modeRadios) {
                if (radio.checked) {
                    selectedMode = radio.value;
                    break;
                }
            }

            // 5. Visual "Loading" State
            // Disable the button so the user can't spam click it while we wait for the network
            scanButton.disabled = true;
            scanButton.classList.add('opacity-80', 'cursor-not-allowed');
            // Hide the word "Analyze Content" and show the spinning CSS loader
            buttonText.textContent = "Scanning...";
            buttonLoader.classList.remove('hidden');
            // Hide previous results if they exist
            resultContainer.classList.add('hidden', 'opacity-0');

            try {
                // 6. THE NETWORK REQUEST (Fetch API)
                // We construct our API URL dynamically based on whether they chose 'sms' or 'email'.
                // If using FastAPI locally, this assumes the HTML is hosted on the same domain (e.g. root router `/`).
                const apiUrl = `/detect-${selectedMode}`;

                // Send a POST request containing JSON data to our python backend
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ text: content }) // Turn our Javascript Object into a JSON String
                });

                // If the response is not HTTP 200 OK, throw a Javascript Error
                if (!response.ok) {
                    throw new Error(`HTTP Error: ${response.status}`);
                }

                // Parse the backend JSON string response back into a Javascript Object
                const data = await response.json();

                // 7. HANDLE THE DATA (Show Results)
                displayResults(data);

            } catch (error) {
                // Network failed (e.g., Python server isn't running)
                console.error("Fetch Error:", error);
                alert("Failed to connect to the backend scanner. Please make sure the API is running.");
            } finally {
                // 8. Visual "Loaded" State Restoration
                // Regardless of whether the fetch succeeded or failed (try vs catch), we finally restore the button.
                scanButton.disabled = false;
                scanButton.classList.remove('opacity-80', 'cursor-not-allowed');
                buttonText.textContent = "Analyze Content";
                buttonLoader.classList.add('hidden');
            }
        }

        /**
         * A helper function that takes the backend 'score' and 'flags' data to update the UI colors and HTML dynamically.
         */
        function displayResults(data) {
            // Grab UI elements
            const container = document.getElementById('result-container');
            const card = document.getElementById('result-card');
            const strip = document.getElementById('result-strip');
            const title = document.getElementById('result-title');
            const label = document.getElementById('result-label');
            const scoreNum = document.getElementById('result-score');
            const flagsList = document.getElementById('result-flags');

            // Strip out ANY previous color classes we added to the card so we start fresh
            card.className = "rounded-xl border p-5 pl-6 relative overflow-hidden transition-colors duration-500";

            // DECISION LOGIC: Determine the Pastel Theme based on the numeric Score
            // Note: These exact color combinations were explicitly requested for the Serene theme
            if (data.score >= 60) {
                // CRITICAL SCAM (Red/Rose Pastel)
                card.classList.add('bg-rose-100', 'text-rose-800', 'border-rose-200');
                strip.classList.add('bg-rose-500');
                title.textContent = "Critical Scam Detected";
                title.classList.add('text-rose-900');
                label.classList.add('text-rose-700');
            }
            else if (data.score >= 30) {
                // SUSPICIOUS (Yellow/Amber Pastel)
                card.classList.add('bg-amber-100', 'text-amber-800', 'border-amber-200');
                strip.classList.add('bg-amber-500');
                title.textContent = "Suspicious Content";
                title.classList.add('text-amber-900');
                label.classList.add('text-amber-700');
            }
            else {
                // SAFE (Green/Emerald Pastel)
                card.classList.add('bg-emerald-100', 'text-emerald-800', 'border-emerald-200');
                strip.classList.add('bg-emerald-500');
                title.textContent = "Appears Safe";
                title.classList.add('text-emerald-900');
                label.classList.add('text-emerald-700');
            }

            // Animate Score Counter (Visual Polish)
            let currentDisplayScore = 0;
            const targetScore = data.score;
            scoreNum.textContent = "0";

            // Use setInterval to quickly jump up the numbers until it hits the target score
            const interval = setInterval(() => {
                if (currentDisplayScore >= targetScore) {
                    clearInterval(interval);
                    scoreNum.textContent = targetScore;
                } else {
                    // Increase counter rapidly based on how large the distance is
                    let increment = Math.max(1, Math.floor((targetScore - currentDisplayScore) / 5));
                    currentDisplayScore += increment;
                    scoreNum.textContent = currentDisplayScore;
                }
            }, 30); // Run every 30 milliseconds

            // Render Logic Flags
            // We clear out the old list list inside the <ul>
            flagsList.innerHTML = '';

            // Loop over the array of string flags from backend. For each flag, create a list-item (`<li>`)
            if (data.flags && data.flags.length > 0) {
                data.flags.forEach(flagText => {
                    const li = document.createElement('li');
                    li.className = "flex items-start gap-2";

                    // Simple logic to add an icon: If it's safe text, show a checkmark, otherwise show a warning bullet
                    const icon = flagText.includes("No suspicious") ? "âœ“" : "â€¢";

                    li.innerHTML = `
                        <span class="font-bold shrink-0 mt-0.5">${icon}</span>
                        <span>${flagText}</span>
                    `;
                    // Attach the created line item to the DOM inside the Unordered List
                    flagsList.appendChild(li);
                });
            }

            // Finally, make the entire result container visible by removing hidden logic
            container.classList.remove('hidden');

            // We use setTimeout to allow the browser a tiny microsecond to render the block *before* applying the opacity transition, forcing the fade-in CSS animation.
            setTimeout(() => {
                container.classList.remove('opacity-0');
                container.classList.add('fade-in');
            }, 10);
        }

        /**
         * Clears the input and hides the results so user can test a new string easily.
         */
        function resetApp() {
            document.getElementById('message-input').value = '';
            const container = document.getElementById('result-container');
            container.classList.add('opacity-0');
            setTimeout(() => {
                container.classList.add('hidden');
            }, 300); // Wait for the fade-out CSS to finish before totally hiding the block physically
        }
    </script>
</body>

</html>